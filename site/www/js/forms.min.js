(function(e){e.fn.extend({forms:function(t){return t===undefined&&(t={}),this.each(function(){var n=e(this),r=n.data("forms"),i={errorCl:"error",emptyCl:"empty",invalidCl:"invalid",successCl:"success",failedCl:"failed",failedCaptchaCl:"failed-captcha",failedAlreadyCl:"failed-already",successShow:"4000",failedShow:"4000",mailHandlerURL:"bin/MailHandler.php",newsletterHandlerURL:"bin/NewsletterHandler.php",newsletterUnsubscribeHandlerURL:"bin/NewsletterUnsubscribeHandler.php",ownerEmail:"contact@kaleessi.fr",stripHTML:!0,smtpMailServer:"localhost",targets:"input,textarea",controls:"a[data-type=reset],a[data-type=submit],a[data-type=submitnews],a[data-type=submitnewsunsubscribe]",validate:!0,rx:{".name":{rx:/^[a-zA-Z'][a-zA-Z-' ]+[a-zA-Z']?$/,target:"input"},".state":{rx:/^[a-zA-Z'][a-zA-Z-' ]+[a-zA-Z']?$/,target:"input"},".email":{rx:/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i,target:"input"},".phone":{rx:/^\+?(\d[\d\-\+\(\) ]{5,}\d$)/,target:"input"},".fax":{rx:/^\+?(\d[\d\-\+\(\) ]{5,}\d$)/,target:"input"},".message":{rx:/.{20}/,target:"textarea"},".captcha":{rx:/^[a-zA-Z0-9]{6}$/,target:"input"}},preFu:function(){i.labels.each(function(){var t=e(this),n=e(i.targets,this),r=n.attr("value"),s=function(){var e=n.is("input")?(e=t.html().match(/value=['"](.+?)['"].+/),!!e&&!!e[1]&&e[1]):n.html();return e}();s!=r&&n.val(r=s||r),t.data({defVal:r}),n.bind("focus",function(){n.val()==r&&(n.val(""),i.hideEmptyFu(t),t.removeClass(i.invalidCl))}).bind("blur",function(){n.val()?i.isValid(t)?i.showErrorFu(t):i.hideErrorFu(t):n.val(r),i.isEmpty(t)?i.showEmptyFu(t):i.hideEmptyFu(t)}).bind("keyup",function(){t.hasClass(i.invalidCl)&&i.isValid(t)?i.showErrorFu(t):i.hideErrorFu(t)}),t.find("."+i.errorCl+",."+i.emptyCl).css({display:"block"}).hide()}),i.success=e("."+i.successCl,i.form).hide(),i.failed=e("."+i.failedCl,i.form).hide(),i.failedcaptcha=e("."+i.failedCaptchaCl,i.form).hide(),i.failedalready=e("."+i.failedAlreadyCl,i.form).hide()},isValid:function(t){var n=!0,r=i.isEmpty(t);return r?(n=!1,t.addClass(i.invalidCl)):e.each(i.rx,function(e,r){t.is(e)&&(r.rx.test(t.find(r.target).val())?(t.removeClass(i.invalidCl),n=!1):t.addClass(i.invalidCl))}),n},isEmpty:function(e){var t;return(t=e.find(i.targets).val())==""||t==e.data("defVal")},validateFu:function(){i.labels.each(function(){var t=e(this);i.isEmpty(t)?i.showEmptyFu(t):i.hideEmptyFu(t),i.isValid(t)?i.showErrorFu(t):i.hideErrorFu(t)})},submitFu:function(){i.validateFu(),i.form.has("."+i.invalidCl).length||e.ajax({type:"POST",url:i.mailHandlerURL,data:{name:e(".name input",i.form).val()||"nope",email:e(".email input",i.form).val()||"nope",phone:e(".phone input",i.form).val()||"nope",fax:e(".fax input",i.form).val()||"nope",state:e(".state input",i.form).val()||"nope",message:e(".message textarea",i.form).val()||"nope",captcha:e(".captcha input",i.form).val()||"nope",owner_email:i.ownerEmail,stripHTML:i.stripHTML},dataType:"json",success:function(e){e.code==0?i.showFu():e.code==2?i.showErrCaptcha(e.msg):i.showErr(e.msg)}})},submitNews:function(){i.validateFu();if(!i.form.has("."+i.invalidCl).length){if(!confirm("Confirmez-vous votre inscription ?")){i.form.trigger("reset");return}e.ajax({type:"POST",url:i.newsletterHandlerURL,data:{email:e(".email input",i.form).val()||"nope"},dataType:"json",success:function(e){e.code==0?i.showFu():e.code==2?i.showErrNewsletterAlready():i.showErrNewsletter()}})}},submitNewsUnsubscribe:function(){i.validateFu();if(!i.form.has("."+i.invalidCl).length){if(!confirm("Confirmez-vous votre d√©sinscription ?")){i.form.trigger("reset");return}e.ajax({type:"POST",url:i.newsletterUnsubscribeHandlerURL,data:{email:e(".email input",i.form).val()||"nope",owner_email:i.ownerEmail},dataType:"json",success:function(e){e.code==0?i.showFu():i.showErrNewsletterUnsubscribe()}})}},showFu:function(){i.success.slideDown(function(){i.form.trigger("reset"),setTimeout(function(){i.success.slideUp()},i.successShow)})},showErr:function(e){i.failed.slideDown(function(){setTimeout(function(){i.failed.slideUp()},i.failedShow)})},showErrNewsletter:function(){i.failed.slideDown(function(){setTimeout(function(){i.failed.slideUp()},i.failedShow)})},showErrNewsletterAlready:function(){i.failedalready.slideDown(function(){setTimeout(function(){i.failedalready.slideUp()},i.failedShow)})},showErrNewsletterUnsubscribe:function(){i.failed.slideDown(function(){setTimeout(function(){i.failed.slideUp()},i.failedShow)})},showErrCaptcha:function(e){i.failedcaptcha.slideDown(function(){setTimeout(function(){i.failedcaptcha.slideUp()},i.failedShow)})},controlsFu:function(){e(i.controls,i.form).each(function(){var t=e(this);t.bind("click",function(){return i.form.trigger(t.data("type")),!1})})},showErrorFu:function(e){e.find("."+i.errorCl).slideDown()},hideErrorFu:function(e){e.find("."+i.errorCl).slideUp()},showEmptyFu:function(e){e.find("."+i.emptyCl).slideDown(),i.hideErrorFu(e)},hideEmptyFu:function(e){e.find("."+i.emptyCl).slideUp()},init:function(){i.form=this,i.labels=e("label",i.form),i.preFu(),i.controlsFu(),i.form.bind("submit",function(){return i.validate?i.submitFu():i.form[0].submit(),!1}).bind("submitnews",function(){return i.validate?i.submitNews():i.form[0].submit(),!1}).bind("submitnewsunsubscribe",function(){return i.validate?i.submitNewsUnsubscribe():i.form[0].submit(),!1}).bind("reset",function(){i.labels.removeClass(i.invalidCl),i.labels.each(function(){var t=e(this);i.hideErrorFu(t),i.hideEmptyFu(t)})}),i.form.trigger("reset")}};r?i=typeof t=="object"?e.extend(r,t):r:((typeof t=="object"?e.extend(i,t):i).init.call(n),n.data({cScroll:i}),r=i)}),this}})})(jQuery);